import math
import collections
from sympy import *
x = Symbol('x')
def cos(a):
    return math.cos(a)
def sin(a):
    return math.sin(a)
def tan(a):
    return math.tan(a)
def asin(a):
    return math.asin(a)
def acos(a):
    return math.acos(a)
def atan(a):
    return math.atan(a)
def log(a):
    return math.log10(a)
def ln(a):
    return math.log(a)
def sqrt(a):
    return math.sqrt(a)
e = 2.71828182846
pi = 3.14159265359
kd = collections.deque()
kv = collections.deque()
equ = collections.deque()
st = collections.deque()
sn = collections.deque()
dp = collections.deque()
do = collections.deque()
ds = collections.deque()
print("\nğ“•ğ“˜ğ“§ğ“”ğ““-ğ“Ÿğ“ğ“˜ğ“ğ“£ ğ“˜ğ“£ğ“”ğ“¡ğ“ğ“£ğ“˜ğ“ğ“ ğ“œğ“”ğ“£ğ“—ğ“ğ““")
f1 = input("\nğ„ğğ“ğ„ğ‘ ğ“ğ‡ğ„ ğ…ğ”ğğ‚ğ“ğˆğğ ğŸ(ğ±) : ")
tol = float(input("ğ„ğğ“ğ„ğ‘ ğ“ğğ‹ğ„ğ‘ğ€ğğ‚ğ„ ğ•ğ€ğ‹ğ”ğ„ : "))
n = int(input("ğ„ğğ“ğ„ğ‘ ğ“ğ‡ğ„ ğğ”ğŒğğ„ğ‘ ğğ… ğ„ğğ”ğ€ğ“ğˆğğğ’ : "))
p = float(input("ğ„ğğ“ğ„ğ‘ ğˆğğˆğ“ğˆğ€ğ‹ ğ…ğˆğ—ğ„ğƒ ğğğˆğğ“ (ğ©ğŸ) : "))
dec = int(input("ğ„ğğ“ğ„ğ‘ ğ‘ğğğ“ ğƒğ„ğ‚ğˆğŒğ€ğ‹ ğğ‘ğ„ğ‚ğˆğ’ğˆğğ : "))
print(end="\n")
f1 = f1.replace("^", "**")
f = eval(f1)
for i in range(0, n, 1):
    print("ğ„ğğ“ğ„ğ‘ ğ ", i+1, "(ğ±)",sep="")
    z1 = input()
    z1 = z1.replace("^", "**")
    z = eval(z1)
    equ.append(z)
for i in range(0, n, 1):
    y = equ[i]
    u = diff(y, x)
    us = str(u)
    r = eval(us, {"x": p, "e": e, "Ï€": pi, "ln": math.log, "log": math.log10, "cos": math.cos, "sin": math.sin, "tan": math.tan, "asin": math.asin, "acos": math.acos, "atan": math.atan, "sqrt": math.sqrt})
    if(abs(r)>1):
        print("\nğ ", i+1, "(ğ±) ğƒğğ„ğ’ ğğğ“ ğ‚ğğğ•ğ„ğ‘ğ†ğ„", sep="", end="\n")
        sn.append(i+1)
    else:
        kd.append(y)
        st.append(i+1)
lens = len(sn)
length = len(kd)
for i in range(0, length, 1):
    count = 0
    print("\nğ…ğğ‘ : ğ ", st[i], "(ğ±)", sep="", end="\n")
    y1 = str(kd[i])
    g1 = eval(y1, {"x": p, "e": e, "Ï€": pi, "ln": math.log, "log": math.log10, "cos": math.cos, "sin": math.sin, "tan": math.tan, "asin": math.asin, "acos": math.acos, "atan": math.atan, "sqrt": math.sqrt})
    g = round(g1, dec)
    kv.append(g)
    h = eval(y1, {"x": g, "e": e, "Ï€": pi, "ln": math.log, "log": math.log10, "cos": math.cos, "sin": math.sin, "tan": math.tan, "asin": math.asin, "acos": math.acos, "atan": math.atan, "sqrt": math.sqrt})
    h1 = round(h, dec)
    kv.append(h1)
    while abs(kv[-1]-kv[-2])>tol:
        y = eval(y1, {"x": kv[-1], "e": e,"ln": math.log, "log": math.log10, "Ï€": pi, "cos": math.cos, "sin": math.sin, "tan": math.tan, "asin": math.asin, "acos": math.acos, "atan": math.atan, "sqrt": math.sqrt})
        kv.append(y)
        count+=1
    dp.append(count + 2)
    length1 = len(kv)
    for i in range(0, length1, 1):
        ok = str(kv[i])
        print("p", i+1, " = f(p", i, ") = ", ok.replace("e", " * 10^"), sep="", end="\n")
    ok2 = str(kv[-1])
    print("ğ‘»ğ‘¯ğ‘¬ ğ‘¹ğ‘¶ğ‘¶ğ‘» ğ‘°ğ‘º  :", ok2.replace("e", " * 10^"),end="\n")
    kv.clear()
print("\nğ‘ğ€ğğŠ : ",end="\n\n")
for i in range(0, lens, 1):
    print("ğ ", sn[i], "(ğ±) ğƒğğ„ğ’ ğğğ“ ğ‚ğğğ•ğ„ğ‘ğ†ğ„")
do = sorted(dp)
lendp = len(do)
print(end="\n")
for i in range(0, lendp, 1):
    for j in range(0, lendp, 1):
        if (do[i]==dp[j]):
            ds.append(st[j])
            dp[j] = 0
for i in range(0, lendp, 1):
    print("ğ ", ds[i], "(ğ±) ğ‚ğğğ•ğ„ğ‘ğ†ğ„ğ’ ğˆğ ", do[i]," ğˆğ“ğ„ğ‘ğ€ğ“ğˆğğğ’",sep="")
